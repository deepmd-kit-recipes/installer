{% set version = os.environ.get("VERSION") %}
{% set cuda_version = os.environ.get("CUDA_VERSION") %}
{% if cuda_version == '' %}
{% set variant = "cpu" %}
{% set variant_version = "cpu" %}
{% else %}
{% set variant = "cuda" %}
{% set variant_version = "cuda" + cuda_version.replace(".", "") %}
{% endif %}

name: deepmd-kit
version: {{ version }}-{{ variant_version }}

channels:
- https://conda.anaconda.org/conda-forge

specs:
- deepmd-kit {{ version }} {{ variant }}*
- lammps
- horovod * {{ variant }}*
- dpdata
- conda
{% if cuda_version != '' %}
- cuda-version {{ cuda_version }}
{% endif %}
{% if cuda_version == '11.8' %}
- https://anaconda.org/njzjz/libdevice-hack-for-tensorflow/0.0.0/download/noarch/libdevice-hack-for-tensorflow-0.0.0-py_3.tar.bz2
{% endif %}
- libblas * *mkl

ignore_duplicate_files: True

license_file: ../LICENSE

company: DeepModeling

pre_install: pre_install.sh
post_install: post_install.sh
